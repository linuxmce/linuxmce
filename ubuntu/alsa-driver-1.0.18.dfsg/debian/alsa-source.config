#!/bin/sh

set -e

. /usr/share/debconf/confmodule
db_version 2.0
db_capb multiselect

if [ -f /etc/alsa-source.conf ]; then
	if [ -f /etc/alsa/alsa-source.conf ]; then
		mv -f /etc/alsa-source.conf /etc/alsa-source.conf.dpkg-old
	else
		mv -f /etc/alsa-source.conf /etc/alsa/alsa-source.conf
	fi
fi

db_metaget alsa-source/cards choices || :
db_subst alsa-source/cards_to_be_built alsa_cards "$RET"

db_metaget alsa-source/cards_with_descriptions choices || :
db_subst alsa-source/cards_to_be_built alsa_cards_with_descriptions "$RET"

if [ -f /etc/alsa/alsa-source.conf ] ; then
	case "$(sed -n -e 's/^[[:space:]]*ALSA_NOPNP[[:space:]]*=[[:space:]]*"\(.*\)"/\1/p' /etc/alsa/alsa-source.conf)" in
		y|Y|yes|YES|Yes) db_set alsa-source/has_pnp "false" || : ;;
		*) db_set alsa-source/has_pnp "true"  || : ;;
	esac
	case "$(sed -n -e 's/^[[:space:]]*ALSA_DEBUG[[:space:]]*=[[:space:]]*"\(.*\)"/\1/p' /etc/alsa/alsa-source.conf)" in
		y|Y|yes|YES|Yes) db_set alsa-source/debug "true"  || : ;;
		*) db_set alsa-source/debug "false" || : ;;
	esac
	db_set alsa-source/cards_to_be_built "$(sed -n -e 's/^[[:space:]]*ALSA_CARDS[[:space:]]*=[[:space:]]*"\(.*\)"/\1/p' /etc/alsa/alsa-source.conf)" || :
fi

db_input low alsa-source/has_pnp || :
db_input low alsa-source/debug || :
db_input low alsa-source/cards_to_be_built || :
db_go || :
db_stop || :

