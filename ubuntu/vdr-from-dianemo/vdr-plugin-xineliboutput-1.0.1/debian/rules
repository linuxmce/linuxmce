#! /bin/sh /usr/share/vdr-dev/make-special-vdr.sh

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/dpatch.mk

DEB_INSTALL_CHANGELOGS_ALL = HISTORY

# install target directory for xine plugins
XINEPLUGINDIR = libxine1-xvdr/$(shell xine-config --plugindir)

MAKE_OPTIONS = DVBDIR=/usr VDRDIR=/usr/include/vdr LIBDIR=. \
               LOCALEDIR=debian/tmp/usr/share/locale \
               NOSIGNAL_IMAGE_FILE=/usr/share/libxine1-xvdr/nosignal.mpg

common-build-arch::
	$(MAKE) all $(MAKE_OPTIONS)

clean::
	$(MAKE) -o .dependencies clean $(MAKE_OPTIONS)
	rm -f libvdr-*.so.*

common-binary-predeb-arch::
	sh /usr/share/vdr-dev/dependencies.sh
	dpkg -p libxine-dev | sed -re '/^Version:/! d; s/^Version: (([0-9]+\.){2}[0-9]+).*$$/xine:Depends=libxine1 (>= \1)/' \
	>> debian/libxine1-xvdr.substvars

install/vdr-plugin-xineliboutput::
	install -d debian/$(XINEPLUGINDIR)/post/
	install xineplug_inp_xvdr.so debian/$(XINEPLUGINDIR)/
	install xineplug_post_*.so debian/$(XINEPLUGINDIR)/post/

VERSION_DATE = $(shell /bin/date --utc +%0Y%0m%0d.%0k%0M)
VERSION_ID = 1.0.0~rc2+cvs$(VERSION_DATE)
get-orig-source:
	echo Downloading vdr-live $(VERSION_ID) from cvs...
	cvs -z3 -d:pserver:anonymous@xineliboutput.cvs.sourceforge.net:/cvsroot/xineliboutput export -DNOW vdr-xineliboutput
	tar cvfz "../vdr-plugin-xineliboutput_$(VERSION_ID).orig.tar.gz" vdr-xineliboutput
	rm -rf vdr-xineliboutput
	dch -v "$(VERSION_ID)-1" "New Upstream Snapshot"
